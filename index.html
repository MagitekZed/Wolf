<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Disc Golf Wolf ‚Äî Mobile‚ÄëFirst Scorekeeper</title>
  <style>
    /* =========================
       Mobile‚Äëfirst design
       ========================= */
    :root{
      --bg: #0d1020;
      --panel: #161a2d;
      --muted: #9aa3b2;
      --text: #eef1f6;
      --accent: #6de5b5;
      --accent-2: #8ab6ff;
      --danger: #ff6b6b;
      --warn: #ffd166;
      --ok: #95e06c;
      --radius: 16px;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1100px 600px at 70% -200px, #1a1e3a 0, #0d1020 55%, #0a0c18 100%);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    /* ----------------- Header ----------------- */
    header{
      position: sticky; top: 0; z-index: 20;
      padding: calc(12px + env(safe-area-inset-top)) 16px 12px 16px;
      background: linear-gradient(180deg, rgba(10,12,24,.92), rgba(10,12,24,.65), rgba(10,12,24,0));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .title{font-weight:800; letter-spacing:.2px; font-size: clamp(18px, 4.8vw, 24px)}
    .subtitle{color:var(--muted); font-size:12px}

    /* ----------------- Layout ----------------- */
    .wrap{max-width:1100px; margin:0 auto; padding: 12px; display:grid; gap:12px}
    .grid{display:grid; grid-template-columns: 1fr; gap:12px}
    @media (min-width: 920px){ .grid{ grid-template-columns: 360px 1fr; gap:18px } }

    .card{background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); box-shadow:var(--shadow)}
    .card .body{padding:14px}
    .card h3{margin:0 0 10px; font-size: clamp(16px, 4.2vw, 18px); letter-spacing:.2px}

    .row{display:flex; gap:10px; align-items:center}
    .row.wrap{flex-wrap:wrap}
    .stack{display:grid; gap:10px}

    input[type="text"], input[type="number"], select{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.14);
      background:#0e1226; color:var(--text); font-size:16px; /* prevent iOS zoom */
    }

    .btn{
      --b: rgba(255,255,255,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
      border:1px solid var(--b); color:var(--text);
      padding: 12px 14px; border-radius: 12px; font-weight: 800; cursor: pointer;
      transition: transform .12s ease, background .2s ease, opacity .2s ease;
      min-height: 44px; touch-action: manipulation; -webkit-tap-highlight-color: transparent;
      font-size: 16px;
    }
    .btn:active{ transform: translateY(1px) }
    .btn:disabled{ opacity:.55; cursor:not-allowed }
    .btn.accent{ background: linear-gradient(180deg, rgba(109,229,181,.28), rgba(109,229,181,.1)); border-color: rgba(109,229,181,.55); color:#0b1b14 }
    .btn.primary{ background: linear-gradient(180deg, rgba(138,182,255,.28), rgba(138,182,255,.1)); border-color: rgba(138,182,255,.55); color:#0b1221 }
    .btn.warn{ background: linear-gradient(180deg, rgba(255,209,102,.28), rgba(255,209,102,.1)); border-color: rgba(255,209,102,.6); color:#1a1300 }
    .btn.danger{ background: linear-gradient(180deg, rgba(255,107,107,.28), rgba(255,107,107,.1)); border-color: rgba(255,107,107,.6); color:#23090b }

    .tag{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:#0c1122; font-size:12px; color:var(--muted)}
    .tag .dot{width:8px; height:8px; border-radius:50%; background:var(--accent); box-shadow:0 0 0 2px rgba(109,229,181,.2)}

    .pill{padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:#0c1222; font-size:12px}
    .hr{height:1px; background:linear-gradient(90deg,transparent, rgba(255,255,255,.12), transparent); margin:6px 0 10px}
    .muted{color:var(--muted)}
    .flex-between{display:flex; align-items:center; justify-content:space-between; gap:12px}

    .chooser{display:flex; gap:8px; overflow-x:auto; -webkit-overflow-scrolling:touch; padding-bottom:6px}
    .chooser .btn{flex:0 0 auto}

    .grid-2{display:grid; grid-template-columns: 1fr; gap:10px}
    @media (min-width:560px){ .grid-2{ grid-template-columns: 1fr 1fr } }

    table{width:100%; border-collapse: collapse}
    th,td{padding:10px 8px; border-bottom:1px dashed rgba(255,255,255,.08); text-align:left}
    th{font-size:12px; color:var(--muted); font-weight:600}
    .score{font-weight:900; font-variant-numeric: tabular-nums}
    .table-wrap{overflow-x:auto; -webkit-overflow-scrolling:touch}

    details summary{cursor:pointer; list-style:none}
    details summary::-webkit-details-marker{display:none}

    .footer{padding: 12px 12px calc(12px + env(safe-area-inset-bottom)); font-size:12px; color:var(--muted); text-align:center}

    @media (prefers-reduced-motion: reduce){
      *{transition:none !important; animation:none !important}
    }
  </style>
</head>
<body>
  <header>
    <div class="flex-between">
      <div>
        <div class="title">üê∫ Disc Golf <span style="color:var(--accent)">Wolf</span> ‚Äî Scorekeeper</div>
        <div class="subtitle">Mobile‚Äëfirst ‚Ä¢ add/remove players ‚Ä¢ rotate Wolf ‚Ä¢ choose partner or Lone Wolf ‚Ä¢ undo ‚Ä¢ autosave</div>
      </div>
      <div class="row">
        <button class="btn" id="helpBtn" aria-expanded="false">Rules</button>
        <button class="btn" id="resetBtn" title="Clear everything">Reset</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <!-- Controls / Players (top on mobile) -->
      <div class="card">
        <div class="body stack">
          <h3>Players</h3>
          <div class="row">
            <input id="playerName" placeholder="Add player name" aria-label="Player name" />
            <button class="btn accent" id="addPlayer">Add</button>
          </div>
          <div id="playersList" class="stack"></div>

          <div class="hr"></div>
          <h3>Game Settings</h3>
          <div class="stack">
            <label class="row" title="Common variant is Wolf tees last. Toggle if your group tees Wolf first.">
              <input type="checkbox" id="wolfTeesFirst" />
              Wolf tees first (instead of last)
            </label>
            <details>
              <summary class="row"><span class="pill">Scoring</span> <span class="muted">(tap to expand)</span></summary>
              <div class="grid-2" style="margin-top:10px">
                <label>2v2 ‚Äî winners (points <em>each</em>)<br><input type="number" id="pts2v2" min="0" step="1" value="1"></label>
                <label>1v3 ‚Äî winners (points <em>each</em>)<br><input type="number" id="pts1v3" min="0" step="1" value="2"></label>
                <label>Lone Wolf ‚Äî Wolf points (win)<br><input type="number" id="ptsLoneWolf" min="0" step="1" value="3"></label>
                <label>Carry ties? (skins‚Äëstyle)<br>
                  <select id="carryTies">
                    <option value="no" selected>No ‚Äî wash the hole</option>
                    <option value="yes">Yes ‚Äî carry to next hole</option>
                  </select>
                </label>
              </div>
              <p class="muted" style="margin-top:6px">Defaults: 2v2=1, 1v3=2, Lone Wolf=3. Edit to match house rules.</p>
            </details>
          </div>
        </div>
      </div>

      <!-- Scoreboard / Flow -->
      <div class="card">
        <div class="body stack">
          <div class="flex-between">
            <h3>Round</h3>
            <div class="row">
              <span class="tag"><span class="dot"></span> <span id="statusTag">Waiting for players‚Ä¶</span></span>
            </div>
          </div>

          <div class="row wrap" id="roundInfo" style="display:none">
            <div class="pill">Hole <strong id="holeNum">1</strong></div>
            <div class="pill">Wolf: <strong id="wolfName">‚Äî</strong></div>
            <div class="pill">Tee order: <strong id="teeOrder">‚Äî</strong></div>
            <div class="pill" id="teeCursorBox" style="display:none">On tee: <strong id="onTee">‚Äî</strong></div>
            <div class="pill">Carryover: <strong id="carryPts">0</strong></div>
          </div>

          <div id="flow" class="stack" style="display:none">
            <div id="phaseTee" class="stack">
              <h3>1) Tee Shots</h3>
              <div class="stack">
                <button class="btn warn" id="declareLone" title="Declare before any tee" aria-label="Declare Lone Wolf before tee">Declare Lone Wolf</button>
                <div class="chooser" id="choosePartnerBox" title="Wolf may choose a partner after seeing a tee shot">
                  <!-- partner buttons injected here -->
                </div>
              </div>
              <button class="btn primary" id="nextTee" style="width:100%">Next tee shot ‚Üí</button>
              <span class="muted" style="font-size:12px">Partner choice locks when you tap it.</span>
            </div>

            <div id="phaseResult" style="display:none">
              <h3>2) Result</h3>
              <div class="stack">
                <button class="btn primary" id="wolfSideWins">Wolf side wins hole</button>
                <button class="btn" id="opponentsWin">Opponents win hole</button>
                <button class="btn" id="tieHole">Tie</button>
              </div>
            </div>

            <div class="row" style="margin-top:8px">
              <button class="btn" id="undoBtn" title="Undo last completed hole">Undo</button>
              <button class="btn" id="newHoleBtn" style="display:none">Next hole ‚Üí</button>
            </div>

            <div class="hr"></div>

            <h3>Scoreboard</h3>
            <div class="table-wrap">
              <table id="scoreTable">
                <thead>
                  <tr><th>Player</th><th>Points</th></tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="card" id="help" style="display:none">
      <div class="body">
        <h3>Wolf ‚Äî Quick Rules</h3>
        <ul class="list" style="padding-left:18px">
          <li><strong>Rotate the Wolf each hole.</strong> Default is Wolf tees last (toggle in Settings for Wolf first).</li>
          <li>After each other player‚Äôs tee, the Wolf may <strong>pick that player</strong> as a partner for 2v2; pass on all to play <strong>1v3</strong>.</li>
          <li><strong>Lone Wolf</strong> must be declared before anyone tees.</li>
          <li><strong>Scoring (editable):</strong> 2v2=1 each; 1v3=2 each; Lone Wolf=3 to Wolf. Optionally carry ties skins‚Äëstyle.</li>
        </ul>
        <p class="muted">Tip: tailor scoring and tee order to your house rules.</p>
      </div>
    </section>

    <div class="footer">Mobile‚Äëfirst ‚Ä¢ Auto‚Äësaves locally ‚Ä¢ Works offline on GitHub Pages</div>
  </main>

  <script>
    // =========================
    // State & persistence
    // =========================
    const LS_KEY = 'wolf_scorekeeper_v2_mobile_first';
    let state = {
      players: [], // {id, name, points}
      hole: 1,
      wolfIndex: 0, // index into players
      wolfTeesFirst: false,
      scoring: { pts2v2: 1, pts1v3: 2, ptsLoneWolf: 3, carryTies: false },
      teeCursor: -1, // -1 before teeing starts; increments through tee order
      partnerId: null,
      loneWolf: false,
      carryBank: 0,
      history: [] // completed holes for undo
    };

    const el = sel => document.querySelector(sel);
    const els = sel => Array.from(document.querySelectorAll(sel));

    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
    function load(){ const s = localStorage.getItem(LS_KEY); if(s){ try{ state = JSON.parse(s); }catch{} } }

    // =========================
    // Helpers
    // =========================
    function uid(){ return Math.random().toString(36).slice(2,9); }
    function playerById(id){ return state.players.find(p=>p.id===id); }
    function currentWolf(){ return state.players[state.wolfIndex] || null; }

    function teeOrder(){
      if(state.players.length === 0) return [];
      const idxs = state.players.map((_,i)=>i);
      if(state.wolfTeesFirst){
        return [state.wolfIndex, ...idxs.filter(i=>i!==state.wolfIndex)];
      } else {
        const others = idxs.filter(i=>i!==state.wolfIndex);
        return [...others, state.wolfIndex];
      }
    }
    function reorderForDisplay(order){
      return order.map(i=>state.players[i]?.name).join(' ‚Üí ');
    }
    function resetHoleFlow(){
      state.teeCursor = -1; state.partnerId = null; state.loneWolf = false; save(); renderFlow();
    }

    // =========================
    // Rendering
    // =========================
    function renderPlayers(){
      const box = el('#playersList');
      box.innerHTML = '';
      state.players.forEach((p, i)=>{
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `
          <span class="pill" style="min-width:34px; text-align:center">${i+1}</span>
          <input data-id="${p.id}" class="editName" value="${p.name}"/>
          <button class="btn" data-id="${p.id}" data-act="moveUp" ${i===0?'disabled':''} aria-label="Move up ${p.name}">‚Üë</button>
          <button class="btn" data-id="${p.id}" data-act="moveDown" ${i===state.players.length-1?'disabled':''} aria-label="Move down ${p.name}">‚Üì</button>
          <button class="btn danger" data-id="${p.id}" data-act="remove" aria-label="Remove ${p.name}">Remove</button>`;
        box.appendChild(row);
      });
    }

    function renderScore(){
      const tbody = el('#scoreTable tbody');
      tbody.innerHTML = '';
      state.players.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.name}</td><td class="score">${p.points||0}</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderRoundInfo(){
      const hasPlayers = state.players.length >= 3; // best with 3‚Äì5
      el('#roundInfo').style.display = hasPlayers ? '' : 'none';
      el('#flow').style.display = hasPlayers ? '' : 'none';
      el('#statusTag').textContent = hasPlayers ? 'In progress' : 'Waiting for players‚Ä¶ (3‚Äì5 recommended)';
      if(!hasPlayers) return;

      const wolf = currentWolf();
      el('#holeNum').textContent = state.hole;
      el('#wolfName').textContent = wolf?.name || '‚Äî';
      const order = teeOrder();
      el('#teeOrder').textContent = reorderForDisplay(order);
      el('#teeCursorBox').style.display = '';
      const onIdx = order[Math.max(0, state.teeCursor)];
      el('#onTee').textContent = (state.teeCursor===-1) ? '‚Äî' : state.players[onIdx]?.name || '‚Äî';
      el('#carryPts').textContent = state.carryBank;

      // Partner buttons (scrollable on mobile)
      const chooseBox = el('#choosePartnerBox');
      chooseBox.innerHTML = '';
      const wolfId = wolf?.id;
      state.players.forEach(p=>{
        if(p.id===wolfId) return;
        const b = document.createElement('button');
        b.className = 'btn';
        b.textContent = `Pick ${p.name}`;
        b.disabled = state.loneWolf || state.partnerId || state.teeCursor < 0; // only after a tee is seen
        b.addEventListener('click', ()=>{ if(state.loneWolf) return; state.partnerId = p.id; save(); renderFlow(); });
        chooseBox.appendChild(b);
      });

      // Lone Wolf & Next Tee
      el('#declareLone').disabled = state.partnerId || state.teeCursor >= 0; // must be before any tee
      el('#nextTee').disabled = state.teeCursor >= state.players.length-1; // after last tee

      // Result phase visible after selection or after final tee
      const canScore = state.loneWolf || state.partnerId || state.teeCursor >= state.players.length-1;
      el('#phaseResult').style.display = canScore ? '' : 'none';

      // Show who is on tee
      el('#onTee').textContent = (state.teeCursor === -1) ? '‚Äî' : state.players[order[state.teeCursor]]?.name || '‚Äî';
    }

    function renderFlow(){
      renderRoundInfo();
      renderScore();
    }

    function renderSettings(){
      el('#wolfTeesFirst').checked = !!state.wolfTeesFirst;
      el('#pts2v2').value = state.scoring.pts2v2;
      el('#pts1v3').value = state.scoring.pts1v3;
      el('#ptsLoneWolf').value = state.scoring.ptsLoneWolf;
      el('#carryTies').value = state.scoring.carryTies ? 'yes' : 'no';
    }

    // =========================
    // Actions
    // =========================
    function addPlayer(name){ if(!name) return; state.players.push({ id: uid(), name: name.trim(), points: 0 }); save(); renderPlayers(); renderFlow(); }
    function removePlayer(id){ const i = state.players.findIndex(p=>p.id===id); if(i<0) return; state.players.splice(i,1); if(state.wolfIndex >= state.players.length) state.wolfIndex = 0; save(); renderPlayers(); renderFlow(); }
    function movePlayer(i, dir){ const j = i + dir; if(j<0 || j>=state.players.length) return; const [p] = state.players.splice(i,1); state.players.splice(j,0,p); save(); renderPlayers(); renderFlow(); }
    function nextTee(){ state.teeCursor = Math.min(state.teeCursor + 1, state.players.length-1); save(); renderFlow(); }
    function declareLone(){ state.loneWolf = true; save(); renderFlow(); }

    function completeHole(result){
      const wolf = currentWolf(); if(!wolf) return;
      const wolfTeam = [wolf.id]; if(state.partnerId) wolfTeam.push(state.partnerId);
      const oppTeam = state.players.filter(p=>!wolfTeam.includes(p.id)).map(p=>p.id);

      const s = state.scoring; let awards = {};
      if(result === 'tie'){
        if(s.carryTies){ state.carryBank += 1; }
      } else {
        let scale = 1 + state.carryBank; state.carryBank = 0;
        if(state.loneWolf){
          if(result === 'wolf'){ awards[wolf.id] = (awards[wolf.id]||0) + s.ptsLoneWolf * scale; }
          else { oppTeam.forEach(id=>{ awards[id] = (awards[id]||0) + 1 * scale; }); }
        } else if(wolfTeam.length === 2){
          const base = s.pts2v2;
          if(result === 'wolf') wolfTeam.forEach(id=>{ awards[id] = (awards[id]||0) + base * scale; });
          else oppTeam.forEach(id=>{ awards[id] = (awards[id]||0) + base * scale; });
        } else {
          const base = s.pts1v3;
          if(result === 'wolf') awards[wolf.id] = (awards[wolf.id]||0) + base * scale;
          else oppTeam.forEach(id=>{ awards[id] = (awards[id]||0) + base * scale; });
        }
      }

      const snapshot = JSON.parse(JSON.stringify({
        hole: state.hole, wolfIndex: state.wolfIndex, partnerId: state.partnerId, loneWolf: state.loneWolf, awards, carryBankAfter: state.carryBank
      }));

      Object.entries(awards).forEach(([id, pts])=>{ const p = playerById(id); if(p) p.points = (p.points||0) + pts; });
      state.history.push(snapshot);

      // Advance
      state.hole += 1;
      state.wolfIndex = (state.wolfIndex + 1) % state.players.length;
      resetHoleFlow(); save(); renderFlow(); flashNextHole();
    }

    function flashNextHole(){ const b = el('#newHoleBtn'); b.style.display = ''; setTimeout(()=> b.style.display='none', 1400); }

    function undo(){
      const last = state.history.pop(); if(!last) return;
      Object.entries(last.awards).forEach(([id, pts])=>{ const p = playerById(id); if(p) p.points = (p.points||0) - pts; });
      state.hole = last.hole; state.wolfIndex = last.wolfIndex; state.partnerId = last.partnerId; state.loneWolf = last.loneWolf; state.carryBank = last.carryBankAfter; state.teeCursor = state.players.length-1; save(); renderFlow();
    }

    function resetAll(){ if(!confirm('Reset players and scores?')) return; state = { players: [], hole: 1, wolfIndex: 0, wolfTeesFirst: false, scoring: { pts2v2: 1, pts1v3: 2, ptsLoneWolf: 3, carryTies: false }, teeCursor: -1, partnerId: null, loneWolf: false, carryBank: 0, history: [] }; save(); renderPlayers(); renderSettings(); renderFlow(); el('#statusTag').textContent='Waiting for players‚Ä¶'; }

    // =========================
    // Wire up UI
    // =========================
    function bind(){
      el('#addPlayer').addEventListener('click', ()=>{ addPlayer(el('#playerName').value); el('#playerName').value=''; el('#playerName').focus(); });
      el('#playerName').addEventListener('keydown', e=>{ if(e.key==='Enter'){ el('#addPlayer').click(); }});

      el('#playersList').addEventListener('input', e=>{ const t = e.target; if(!t.classList.contains('editName')) return; const p = playerById(t.dataset.id); if(p){ p.name = t.value; save(); renderFlow(); }});
      el('#playersList').addEventListener('click', e=>{
        const act = e.target.dataset.act; if(!act) return; const id = e.target.dataset.id;
        if(act==='remove') removePlayer(id);
        if(act==='moveUp'){ const i = state.players.findIndex(p=>p.id===id); movePlayer(i, -1); }
        if(act==='moveDown'){ const i = state.players.findIndex(p=>p.id===id); movePlayer(i, +1); }
      });

      // Settings
      el('#wolfTeesFirst').addEventListener('change', e=>{ state.wolfTeesFirst = e.target.checked; save(); renderFlow(); });
      el('#pts2v2').addEventListener('change', e=>{ state.scoring.pts2v2 = parseInt(e.target.value||'0',10); save(); });
      el('#pts1v3').addEventListener('change', e=>{ state.scoring.pts1v3 = parseInt(e.target.value||'0',10); save(); });
      el('#ptsLoneWolf').addEventListener('change', e=>{ state.scoring.ptsLoneWolf = parseInt(e.target.value||'0',10); save(); });
      el('#carryTies').addEventListener('change', e=>{ state.scoring.carryTies = (e.target.value==='yes'); save(); });

      // Flow
      el('#nextTee').addEventListener('click', nextTee);
      el('#declareLone').addEventListener('click', declareLone);
      el('#wolfSideWins').addEventListener('click', ()=>completeHole('wolf'));
      el('#opponentsWin').addEventListener('click', ()=>completeHole('opponents'));
      el('#tieHole').addEventListener('click', ()=>completeHole('tie'));
      el('#undoBtn').addEventListener('click', undo);
      el('#newHoleBtn').addEventListener('click', ()=>{});

      // Help & reset
      el('#helpBtn').addEventListener('click', ()=>{ const help = el('#help'); const nowOpen = (help.style.display==='none' || help.style.display==='') ? true : false; help.style.display = nowOpen ? '' : 'none'; el('#helpBtn').setAttribute('aria-expanded', String(nowOpen)); });
      el('#resetBtn').addEventListener('click', resetAll);
    }

    // =========================
    // Init
    // =========================
    load(); bind(); renderPlayers(); renderSettings(); renderFlow();
  </script>
</body>
</html>
